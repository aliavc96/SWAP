# Práctica 4: Seguridad en los Servidores Web


## Información general

El objetivo de esta práctica será mejorar nuestra granja web para permitir el acceso por https y tener algún tipo de seguridad de forma que 
con Ifconfig podamos filtrar el tráfico y permitir el acceso sólo a lo que nos interese.

Necesitaremos un certificado tipo SSL donde se cifrarán las comunicaciones para que el tráfico circule de foma segura.

Tipo de certificado a utilizar:
Autofirmado --> genera un fichero .key y otro con extensión .crt que será almacenado en la máquina servidora para filtrar las comunicaciones.


## Generando el certificado con SSL

Siguiendo los pasos del guión, he llegado a crear ambos archivos: .key y .crt en el servidor cuya IP 10.0.2.15 con la siguiente orden (antes de 
realizar la orden tenemos que activar el módulo SSL de Apache, reiniciar el mismo y crear el directorio donde se almacenarán los archivos ):

`a2enmod ssl`

`service apache2 restart`

`mkdir /etc/apache2/ssl`

`openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout
/etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt`

Nos pedirá una serie de datos que podremos optar por no rellenar.


Posteriormente le he pasado los archivos generados al balanceador de carga y al otro servidor para habilitar la autofirma en la granja web.
Para transferir los archivos he aplicado la siguiente orden:

`sudo scp usuario@ip_maquina_origen:/etc/apache2/ssl/* /etc/apache2/ssl`


![captura 1](https://github.com/aliavc96/SWAP/blob/master/practicas/practica4/transferenciaServer2.PNG)

En cada servidor tenemos que editar el archivo de configuración de ssl para indicarle dónde hemos ubicado los archivos. Las lineas añadidas 
se muestran a continuación:

`SSLCertificateFile /etc/apache2/ssl/apache.crt`

`SSLCertificateKeyFile /etc/apache2/ssl/apache.key`

Después he activado el sitio default-ssl y he reiniciado apache para que los cambios sean asumidos.

Luego he añadido al archivo de configuración de Nginx la ubicación de ambos archivos para los dos servidores con el objetivo de que 
el acceso por https se realice con el certificado:


![captura 2](https://github.com/aliavc96/SWAP/blob/master/practicas/practica4/configuracionNginx.PNG)

A continuación se muestra el acceso a los servidores web (10.0.2.7 y 10.0.2.15) y al balanceador de carga (10.0.2.8) mediante HTTPS con el 
certificado incluido funcionando:


![captura 3](https://github.com/aliavc96/SWAP/blob/master/practicas/practica4/accediendoConAutoFirma.PNG)


![captura 4](https://github.com/aliavc96/SWAP/blob/master/practicas/practica4/accediendoApacheMaquina2.PNG)


![captura 5](https://github.com/aliavc96/SWAP/blob/master/practicas/practica4/autofirma2.PNG)


![captura 6](https://github.com/aliavc96/SWAP/blob/master/practicas/practica4/nginxMaquina1.PNG)

## Configuración del cortafuegos

Para llevar a cabo la configuración del cortafuegos de modo que solo mantenga abiertos el puerto 80, el 225, y el 22, he creado un script 
y lo he copiado en /etc como rc.local para que se ejecute cada vez que se inicia el sistema.

![captura 7](https://github.com/aliavc96/SWAP/blob/master/practicas/practica4/confFirewall.JPG)

Después he hecho Ping desde otra máquina para comprobar la correcta configuración y se puede ver en la siguiente imagen que no lo recibe correctamente, 
y sin embargo el acceso por ssh, por http (y https) si:


![captura 8](https://github.com/aliavc96/SWAP/blob/master/practicas/practica4/sshServer1.JPG)


